{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user in the Loni Panchayat Tax Management System.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number."
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "role": {
          "type": "string",
          "description": "User's role (e.g., citizen, admin, operator, viewer)."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "role"
      ]
    },
    "Property": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Property",
      "type": "object",
      "description": "Represents a property registered in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Property entity."
        },
        "ownerSystemId": {
          "type": "string",
          "description": "Reference to the UserProfile who owns the property. (Relationship: UserProfile 1:N Property)"
        },
        "houseNo": {
          "type": "string",
          "description": "House number or identifier."
        },
        "propertyType": {
          "type": "string",
          "description": "Type of property (Residential/Commercial/Agricultural)."
        },
        "area": {
          "type": "number",
          "description": "Area of the property (sq.ft or acres)."
        },
        "aadhaarNumber": {
          "type": "string",
          "description": "Aadhaar number of the property owner (encrypted)."
        }
      },
      "required": [
        "id",
        "ownerSystemId",
        "houseNo",
        "propertyType",
        "area"
      ]
    },
    "TaxRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TaxRecord",
      "type": "object",
      "description": "Represents a tax record for a property.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TaxRecord entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to the Property the tax record is for. (Relationship: Property 1:N TaxRecord)"
        },
        "assessmentYear": {
          "type": "number",
          "description": "Year for which the tax is assessed."
        },
        "taxType": {
          "type": "string",
          "description": "Type of tax (e.g., House Tax, Land Tax)."
        },
        "assessedAmount": {
          "type": "number",
          "description": "Amount of tax assessed."
        },
        "amountDue": {
          "type": "number",
          "description": "Remaining amount of tax due."
        },
        "amountPaid": {
          "type": "number",
          "description": "Amount of tax paid."
        },
        "paymentStatus": {
          "type": "string",
          "description": "Payment status (Paid/Unpaid/Partial)."
        },
        "paymentDate": {
          "type": "string",
          "description": "Date of payment.",
          "format": "date-time"
        },
        "receiptNo": {
          "type": "string",
          "description": "Receipt number for the payment."
        }
      },
      "required": [
        "id",
        "propertyId",
        "assessmentYear",
        "taxType",
        "assessedAmount",
        "amountDue",
        "amountPaid",
        "paymentStatus"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.  The document ID is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/properties/{propertyId}",
        "definition": {
          "entityName": "Property",
          "schema": {
            "$ref": "#/backend/entities/Property"
          },
          "description": "Stores property records. `ownerSystemId` links to the UserProfile document.",
          "params": [
            {
              "name": "propertyId",
              "description": "Unique identifier for the property."
            }
          ]
        }
      },
      {
        "path": "/properties/{propertyId}/tax_records/{taxRecordId}",
        "definition": {
          "entityName": "TaxRecord",
          "schema": {
            "$ref": "#/backend/entities/TaxRecord"
          },
          "description": "Stores tax records for a specific property.",
          "params": [
            {
              "name": "propertyId",
              "description": "The ID of the property the tax record belongs to."
            },
            {
              "name": "taxRecordId",
              "description": "Unique identifier for the tax record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage user profiles, property records, and tax information for the Loni Panchayat Tax Management System. It prioritizes authorization independence by avoiding hierarchical `get()` calls in security rules.  User profiles are stored in `/users/{userId}`. Properties are stored in `/properties/{propertyId}`, with the `ownerSystemId` field linking back to the user. Tax records are stored in `/properties/{propertyId}/tax_records/{taxRecordId}`, with the `propertyId` linking back to the property, providing a clear ownership structure.  This parent/child relationship facilitates simple security rules based on ownership.  \n\n**Authorization Independence (CRITICAL):**  The `TaxRecord` subcollection includes the `propertyId`.  While not strictly a denormalization of user data, it allows security rules on `TaxRecord` to verify the existence of the parent `Property` without needing to `get()` the user document.  This avoids cascading failures if user data changes.  User roles are stored directly in the `UserProfile` document.\n\n**QAPs (Rules are not Filters):** The structure supports secure `list` operations. Listing properties can be secured based on user role or ownership. Listing tax records associated with a property is straightforward using collection group queries and security rules that check the requesting user's role/ownership on the parent `Property` document.\n\n**DBAC (No Custom Claims):** User roles are stored in the `UserProfile` document (`/users/{userId}`). Security rules will check the `role` field in the `UserProfile` to grant or restrict access to certain functionalities.\n\n**Structural Segregation (Homogeneous Security Posture):** Each collection (`users`, `properties`, `tax_records`) is designed to hold documents with similar security requirements. User profiles are private to the user and admins, properties are accessible to owners and admins, and tax records follow the access control of their parent property.\n\n**Access Modeling (Standardization and Consistency):**  Path-based ownership is used for user data (`/users/{userId}`). The `Property` to `TaxRecord` relationship is modeled using subcollections, extending the hierarchical path for nested data (`/properties/{propertyId}/tax_records/{taxRecordId}`)."
  }
}